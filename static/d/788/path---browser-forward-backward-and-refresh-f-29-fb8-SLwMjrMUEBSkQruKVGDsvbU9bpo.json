{"data":{"site":{"siteMetadata":{"title":"Magpie","author":"Dan Geng"}},"markdownRemark":{"id":"1b9f0217-ae1b-5831-96b4-d3a6b4d208d6","excerpt":"问题 Web应用在Chrome里调试时正常，但是在移动端测试时点击后退不会刷新页面数据。 查看了移动端输出信息后，发现确实是接口数据都走了缓存。 我的后退是通过History API…","html":"<h2>问题</h2>\n<p><em>Web应用在Chrome里调试时正常，但是在移动端测试时点击后退不会刷新页面数据。</em></p>\n<p>查看了移动端输出信息后，发现确实是接口数据都走了缓存。</p>\n<p>我的后退是通过History API实现的：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">history<span class=\"token punctuation\">.</span><span class=\"token function\">back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// history.go(-1); 与上面代码起同样作用</span></code></pre></div>\n<h2>解决？</h2>\n<p>经过查找发现，<strong>桌面端与移动端浏览器在对后退按钮的处理是有区别的</strong>。桌面端在后退到上一页面时会刷新页面，包括表单数据等都会更新。然而在移动端则不会刷新，数据不会发生变化。这样的设计可能针对存在慢速连接的移动端，可以说，有其道理.. </p>\n<p>一个并不完美的替代方案是使用<code class=\"language-text\">document.referrer</code>。</p>\n<p>它的定义是：</p>\n<blockquote>\n<p>Returns the URI of the page taht linked to this page.</p>\n</blockquote>\n<p>就是返回链接到此页面的页面的URI。</p>\n<p><em>(注意：如果是用户直接导航到当前页面（没有通过一个链接，比如从书签）的情况，它的值是一个空字符串。)</em></p>\n<p>我们可以这样写来达到假返回的效果：</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span>referrer<span class=\"token punctuation\">;</span></code></pre></div>\n<p>之所以是假返回，因为这其实是一个前进操作。。如果使用<code class=\"language-text\">hostory.back()</code>方法，会返回到历史记录中的上一条记录，然而使用上面这种的话会在历史记录中再添加新的一条记录，这与我的初衷并不相符，所以说并不是完美的解决方案。</p>\n<p>那么问题来了，应该如何完美解决呢？</p>\n<p>才疏学浅，母鸡啦。</p>","frontmatter":{"title":"浏览器的前进、后退与刷新","date":"February 27, 2018"}}},"pageContext":{"slug":"/browser-forward-backward-and-refresh/","previous":{"fields":{"slug":"/syncing-a-fork/"},"frontmatter":{"title":"如何同步一个fork仓库"}},"next":null}}